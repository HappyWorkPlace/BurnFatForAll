<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Leaderboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }

        .leaderboard {
            width: 90%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .leaderboard h2 {
            background-color: #3B9097;
            color: white;
            text-align: center;
            margin: 0;
            padding: 15px;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            background-color: #ddd;
            cursor: pointer;
        }

        .tabs div {
            padding: 10px;
            width: 50%;
            text-align: center;
            background-color: #ddd;
        }

        .tabs div.active {
            background-color: #3B9097;
            color: white;
        }

        .leaderboard-content {
            padding: 20px;
        }

        .leaderboard-content table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-content th, .leaderboard-content td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .leaderboard-content th {
            background-color: #f6e2bc;
        }

        .leaderboard-content td:first-child {
            text-align: center;
        }

        .leaderboard-content td.rank {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô */
        }

        .leaderboard-content td.rank img {
            width: 20px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô */
            height: 20px;
        }
    </style>
</head>
<body>

<div class="leaderboard">
    <h2>Leaderboard</h2>
    <div class="tabs">
        <div id="cumulativeTab" class="active">Cumulative High Scores</div>
        <div id="singleGameTab">Highest Scores Per Game</div>
    </div>
    <div class="leaderboard-content">
        <table id="leaderboardTable">
            <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
        </table>
    </div>
</div>

<script>
    const cumulativeTab = document.getElementById('cumulativeTab');
    const singleGameTab = document.getElementById('singleGameTab');
    const leaderboardTable = document.getElementById('leaderboardTable');
    
    const API_URL = 'https://script.google.com/macros/s/AKfycbzbi7RXlvS1Lm-o15jKjHJQLxGxZtZm9eR19SMq046xe3tU53JxC1eIGCYlwZ3-tBPu/exec';

    let cumulativeScores = [];
    let singleGameScores = [];

    async function fetchRankingData(sheetName) {
        const response = await fetch(`${API_URL}?sheet=${sheetName}`);
        const data = await response.json();
        return data;
    }

    async function preloadData() {
        [cumulativeScores, singleGameScores] = await Promise.all([
            fetchRankingData('Ranking_Cumulative'),
            fetchRankingData('Ranking_Highest')
        ]);
        renderLeaderboard(cumulativeScores);
    }

    function renderLeaderboard(data) {
        data.sort((a, b) => b.point - a.point);

        leaderboardTable.innerHTML = `
            <tr>
                <th>Rank</th>
                <th>Point</th>
                <th>Name</th>
                <th>Factory</th>
                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Å‡∏°</th>
            </tr>
        `;

        let previousScore = null;
        let currentRank = 0;
        let displayRank = 0;

        data.forEach((player, index) => {
            if (player.point !== previousScore) {
                displayRank = currentRank + 1;
            }
            currentRank++;
            previousScore = player.point;

            let icon = '';
            if (displayRank === 1) icon = 'ü•á';
            else if (displayRank === 2) icon = 'ü•à';
            else if (displayRank === 3) icon = 'ü•â';

            leaderboardTable.innerHTML += `
                <tr>
                    <td class="rank"><span>${displayRank}</span> ${icon}</td>
                    <td>${player.point}</td>
                    <td>${player.name}</td>
                    <td>${player.factory}</td>
                    <td>${player.games}</td>
                </tr>
            `;
        });
    }

    cumulativeTab.addEventListener('click', () => {
        cumulativeTab.classList.add('active');
        singleGameTab.classList.remove('active');
        renderLeaderboard(cumulativeScores);
    });

    singleGameTab.addEventListener('click', () => {
        singleGameTab.classList.add('active');
        cumulativeTab.classList.remove('active');
        renderLeaderboard(singleGameScores);
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
    preloadData();
</script>

</body>
</html>
